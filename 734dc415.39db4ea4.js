(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{72:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return i})),n.d(t,"metadata",(function(){return c})),n.d(t,"rightToc",(function(){return l})),n.d(t,"default",(function(){return p}));var a=n(2),o=n(6),r=(n(0),n(97)),i={id:"docker_simple",title:"Docker Default Installation Guide",sidebar_label:"Docker Simple"},c={unversionedId:"deploy/docker_simple",id:"deploy/docker_simple",isDocsHomePage:!1,title:"Docker Default Installation Guide",description:"Dockerized Nfdump",source:"@site/docs/deploy/docker_install_simple.md",slug:"/deploy/docker_simple",permalink:"/netsage-pipeline/docs/next/deploy/docker_simple",editUrl:"https://github.com/netsage-project/netsage-pipeline/edit/master/website/docs/deploy/docker_install_simple.md",version:"current",sidebar_label:"Docker Simple",sidebar:"Docker",previous:{title:"Docker Installation Guide",permalink:"/netsage-pipeline/docs/next/deploy/docker_install"},next:{title:"Docker Advanced Installation Guide",permalink:"/netsage-pipeline/docs/next/deploy/docker_advanced"}},l=[{value:"Dockerized Nfdump",id:"dockerized-nfdump",children:[{value:"Step 1 Create a config",id:"step-1-create-a-config",children:[]},{value:"Step 2 Create an unique environment variable",id:"step-2-create-an-unique-environment-variable",children:[]},{value:"Running the collectors",id:"running-the-collectors",children:[]}]},{value:"Running the Pipeline",id:"running-the-pipeline",children:[{value:"Environment file",id:"environment-file",children:[]},{value:"Bringing up the Pipeline",id:"bringing-up-the-pipeline",children:[]}]},{value:"Upgrading",id:"upgrading",children:[]}],s={rightToc:l};function p(e){var t=e.components,n=Object(o.a)(e,["components"]);return Object(r.b)("wrapper",Object(a.a)({},s,n,{components:t,mdxType:"MDXLayout"}),Object(r.b)("h2",{id:"dockerized-nfdump"},"Dockerized Nfdump"),Object(r.b)("p",null,"If you wish to use dockerized version of the collectors, then there are three components to be aware of."),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},"collector docker container needs to run listening for sflow, or netflow traffic."),Object(r.b)("li",{parentName:"ul"},"an ENV value needs to be set that tags the sensor name."),Object(r.b)("li",{parentName:"ul"},"a unique data output path should be set."),Object(r.b)("li",{parentName:"ul"},"importer needs to be updated to be aware of the filepath and the sensor name.")),Object(r.b)("h3",{id:"step-1-create-a-config"},"Step 1 Create a config"),Object(r.b)("p",null,"The default pattern is defined in the docker-compose.override_example.yml. By default we bring up a single netflow collector and a single sflow collector. For most people this is more than enough. You may wish to delete collectors you're not using."),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-sh"}),"cp docker-compose.override_example.yml docker-compose.override.yml\n")),Object(r.b)("p",null,"If you're sticking to the default you don't need to make any changes to the docker-compose.override_example.yml"),Object(r.b)("div",{className:"admonition admonition-note alert alert--secondary"},Object(r.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-heading"}),Object(r.b)("h5",{parentName:"div"},Object(r.b)("span",Object(a.a)({parentName:"h5"},{className:"admonition-icon"}),Object(r.b)("svg",Object(a.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"}),Object(r.b)("path",Object(a.a)({parentName:"svg"},{fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"})))),"note")),Object(r.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-content"}),Object(r.b)("p",{parentName:"div"},"You may need to remove all the comments in the override file as they may conflict with the parsing done by docker-compose"))),Object(r.b)("div",{className:"admonition admonition-note alert alert--secondary"},Object(r.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-heading"}),Object(r.b)("h5",{parentName:"div"},Object(r.b)("span",Object(a.a)({parentName:"h5"},{className:"admonition-icon"}),Object(r.b)("svg",Object(a.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"}),Object(r.b)("path",Object(a.a)({parentName:"svg"},{fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"})))),"note")),Object(r.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-content"}),Object(r.b)("p",{parentName:"div"},"If you are only interested in netflow or sflow data, you may want to remove the collector configuration that is not used."))),Object(r.b)("h3",{id:"step-2-create-an-unique-environment-variable"},"Step 2 Create an unique environment variable"),Object(r.b)("p",null,"default value are set in the .env default to"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-sh"}),"sflowSensorName=sflowSensorName\nnetflowSensorName=netflowSensorName\n")),Object(r.b)("p",null,"simply change the names to a unique identifier and you're good to go."),Object(r.b)("p",null,"These names uniquely identify the source of the data. If you're not using the netflow or sflow collector, then simply disregard the env settings."),Object(r.b)("h3",{id:"running-the-collectors"},"Running the collectors"),Object(r.b)("p",null,"After selecting the docker version to run, you can start the collectors by running the following line"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-sh"}),"docker-compose up -d sflow-collector netflow-collector\n")),Object(r.b)("p",null,"By default the container comes up and will write data to ",Object(r.b)("inlineCode",{parentName:"p"},"./data/input_data")," . Each collector is namespaced by its type so sflow collector will write data to ",Object(r.b)("inlineCode",{parentName:"p"},"./data/input_data/slow")," , it's sensor name is: sflowSensorName and listen to udp traffic on localhost:9999."),Object(r.b)("h2",{id:"running-the-pipeline"},"Running the Pipeline"),Object(r.b)("p",null,"Once you've created the docker-compose.override.xml and finished adjusting it for any customizations, then you're ready to select your version."),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},"Select Release version",Object(r.b)("ul",{parentName:"li"},Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"git fetch; git checkout <tag name>"),' replace "tag name" with v1.2.5 or the version you intend to use.'),Object(r.b)("li",{parentName:"ul"},"Please select the version you wish to use using ",Object(r.b)("inlineCode",{parentName:"li"},"./scripts/docker_select_version.sh"))))),Object(r.b)("h3",{id:"environment-file"},"Environment file"),Object(r.b)("p",null,Object(r.b)("p",{parentName:"p"},"Please make a copy of the .env and refer back to the docker ",Object(r.b)("a",Object(a.a)({parentName:"p"},{href:"../devel/docker"}),"dev guide")," on details on configuring the env. Most of the default value should work just fine."),Object(r.b)("p",{parentName:"p"},"The only major change you should be aware of are the following values. The output host defines where the final data will land. The sensorName defines what the data will be labeled as."),Object(r.b)("p",{parentName:"p"},"If you don't send a sensor name it'll use the default docker hostname which changes each time you run the pipeline."),Object(r.b)("pre",{parentName:"p"},Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-ini"}),"rabbitmq_output_host=rabbit\nrabbitmq_output_username=guest\nrabbitmq_output_pw=guest\nrabbitmq_output_key=netsage_archive_input\n\nsflowSensorName=sflowSensorName\nnetflowSensorName=netflowSensorName\n\n## Optional configurations\n## Not required, but these are exposed if you wish to use a different\n## value \naggregation_maps_path=/data/logstash-aggregation-maps ## this is configurable, but /data is required.  \ninactivity_timeout=630 ##  See below\nmax_flow_timeout=86400 ## cut off flows that are longer the N seconds.  Default is 24 hours\n")),Object(r.b)("p",{parentName:"p"},"Please note, the default is to have one netflow collector and one sflow collector. If you need more collectors or do no need netflow or sflow simply comment out the collector you wish to ignore.  If you are following the advanced guide, you'll naturally have a more complex setup for each additional collector you've configured."),Object(r.b)("h3",{parentName:"p"},"inactivity_timeout"),Object(r.b)("div",Object(a.a)({parentName:"p"},{className:"admonition admonition-note alert alert--secondary"}),Object(r.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-heading"}),Object(r.b)("h5",{parentName:"div"},Object(r.b)("span",Object(a.a)({parentName:"h5"},{className:"admonition-icon"}),Object(r.b)("svg",Object(a.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"}),Object(r.b)("path",Object(a.a)({parentName:"svg"},{fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"})))),"note")),Object(r.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-content"}),Object(r.b)("p",{parentName:"div"},"If more than inactivity_timeout seconds have passed between the 'start' of this event and the 'start'\nof the LAST matching event, OR if no matching flow has coming in for inactivity_timeout seconds\non the clock, assume the flow has ended.\nUse 630 sec = 10.5 min for 5-min files,  960 sec = 16 min for AMPATH which has has 15-min files.\n(For 5-min files, this allows one 5 min gap or period during which the no. of bits transferred don't meet the cutoff)")))),Object(r.b)("h3",{id:"bringing-up-the-pipeline"},"Bringing up the Pipeline"),Object(r.b)("p",null,Object(r.b)("p",{parentName:"p"},"Starting up the pipeline using:"),Object(r.b)("pre",{parentName:"p"},Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-sh"}),"docker-compose up -d\n")),Object(r.b)("p",{parentName:"p"},"You can check the logs for each of the container by running"),Object(r.b)("pre",{parentName:"p"},Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-sh"}),"docker-compose logs\n")),Object(r.b)("h3",{parentName:"p"},"Shutting Down the pipeline."),Object(r.b)("pre",{parentName:"p"},Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-sh"}),"docker-compose down\n"))),Object(r.b)("h2",{id:"upgrading"},"Upgrading"),Object(r.b)("p",null,Object(r.b)("h3",{parentName:"p"},"Update Source Code"),Object(r.b)("p",{parentName:"p"},"If your only changes are the version you selected simply reset and discard your changes."),Object(r.b)("pre",{parentName:"p"},Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-sh"}),"git reset --hard\n")),Object(r.b)("p",{parentName:"p"},"Update the git repo. Likely this won't change anything but it's always a good practice to have the latest version. You will need to do at least a git fetch in order to see the latest tags."),Object(r.b)("pre",{parentName:"p"},Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-sh"}),"git pull origin master\n")),Object(r.b)("h3",{parentName:"p"},"Collectors"),Object(r.b)("p",{parentName:"p"},"Since the collectors live outside of version control. Please check the docker-compose.override_example.yml and see if there any changes you need to bring in."),Object(r.b)("p",{parentName:"p"},"Likely the only change of note might be the docker version."),Object(r.b)("pre",{parentName:"p"},Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-yaml"}),'version: "3.7"\n')),Object(r.b)("h3",{parentName:"p"},"Select Release Version"),Object(r.b)("ol",{parentName:"p"},Object(r.b)("li",{parentName:"ol"},"git checkout <tag_value> (ie. v1.2.6, v1.2.7 etc)"),Object(r.b)("li",{parentName:"ol"},Object(r.b)("inlineCode",{parentName:"li"},"./scripts/docker_select_version.sh")," select the same version as the tag you checked out.")),Object(r.b)("h3",{parentName:"p"},"Update docker containers"),Object(r.b)("p",{parentName:"p"},"This applies for both development and release"),Object(r.b)("pre",{parentName:"p"},Object(r.b)("code",Object(a.a)({parentName:"pre"},{}),"docker-compose pull\n"))))}p.isMDXComponent=!0},97:function(e,t,n){"use strict";n.d(t,"a",(function(){return d})),n.d(t,"b",(function(){return m}));var a=n(0),o=n.n(a);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var s=o.a.createContext({}),p=function(e){var t=o.a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):c(c({},t),e)),n},d=function(e){var t=p(e.components);return o.a.createElement(s.Provider,{value:t},e.children)},b={inlineCode:"code",wrapper:function(e){var t=e.children;return o.a.createElement(o.a.Fragment,{},t)}},u=o.a.forwardRef((function(e,t){var n=e.components,a=e.mdxType,r=e.originalType,i=e.parentName,s=l(e,["components","mdxType","originalType","parentName"]),d=p(n),u=a,m=d["".concat(i,".").concat(u)]||d[u]||b[u]||r;return n?o.a.createElement(m,c(c({ref:t},s),{},{components:n})):o.a.createElement(m,c({ref:t},s))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var r=n.length,i=new Array(r);i[0]=u;var c={};for(var l in t)hasOwnProperty.call(t,l)&&(c[l]=t[l]);c.originalType=e,c.mdxType="string"==typeof e?e:a,i[1]=c;for(var s=2;s<r;s++)i[s]=n[s];return o.a.createElement.apply(null,i)}return o.a.createElement.apply(null,n)}u.displayName="MDXCreateElement"}}]);