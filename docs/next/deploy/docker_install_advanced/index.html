<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.66">
<title data-react-helmet="true">Docker Advanced Installation Guide | Netsage Pipeline Documentation</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" name="docusaurus_language" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Docker Advanced Installation Guide | Netsage Pipeline Documentation"><meta data-react-helmet="true" name="description" content="Dockerized Nfdump"><meta data-react-helmet="true" property="og:description" content="Dockerized Nfdump"><meta data-react-helmet="true" property="og:url" content="https://netsage-project.github.io/netsage-pipeline/docs/next/deploy/docker_install_advanced"><link data-react-helmet="true" rel="shortcut icon" href="/netsage-pipeline/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://netsage-project.github.io/netsage-pipeline/docs/next/deploy/docker_install_advanced"><link rel="stylesheet" href="/netsage-pipeline/styles.bf9b0f11.css">
<link rel="preload" href="/netsage-pipeline/styles.30a89ff9.js" as="script">
<link rel="preload" href="/netsage-pipeline/runtime~main.5ea87a7f.js" as="script">
<link rel="preload" href="/netsage-pipeline/main.f582d45e.js" as="script">
<link rel="preload" href="/netsage-pipeline/1.e1463b01.js" as="script">
<link rel="preload" href="/netsage-pipeline/2.444a8fa2.js" as="script">
<link rel="preload" href="/netsage-pipeline/43.5653398d.js" as="script">
<link rel="preload" href="/netsage-pipeline/44.4b500b20.js" as="script">
<link rel="preload" href="/netsage-pipeline/935f2afb.4f4751f2.js" as="script">
<link rel="preload" href="/netsage-pipeline/17896441.3d630ac9.js" as="script">
<link rel="preload" href="/netsage-pipeline/cbd1c0d0.e0c9944f.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/netsage-pipeline/"><img class="navbar__logo" src="/netsage-pipeline/img/logo.png" alt="NetSage Logo"><strong class="navbar__title">NetSage Documentation</strong></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/netsage-pipeline/docs/pipeline">Pipeline Documentation</a><a href="https://netsage-project.github.io/netsage-grafana-configs/" target="_self" rel="noopener noreferrer" class="navbar__item navbar__link">Dashboard Documentation</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__item navbar__link" href="/netsage-pipeline/docs/next/pipeline/intro">master (unreleased)</a><ul class="dropdown__menu"><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/netsage-pipeline/docs/next/deploy/docker_install_advanced">master (unreleased)</a></li><li><a class="dropdown__link" href="/netsage-pipeline/docs/pipeline">1.2.6</a></li><li><a class="dropdown__link" href="/netsage-pipeline/docs/1.2.5/pipeline">1.2.5</a></li></ul></div><a href="https://github.com/netsage-project/netsage-pipeline/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2aTZ"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_BsTx">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_BsTx">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/netsage-pipeline/"><img class="navbar__logo" src="/netsage-pipeline/img/logo.png" alt="NetSage Logo"><strong class="navbar__title">NetSage Documentation</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/netsage-pipeline/docs/pipeline">Pipeline Documentation</a></li><li class="menu__list-item"><a href="https://netsage-project.github.io/netsage-grafana-configs/" target="_self" rel="noopener noreferrer" class="menu__link">Dashboard Documentation</a></li><li class="menu__list-item"><a role="button" class="menu__link menu__link--sublist">Versions</a><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active" href="/netsage-pipeline/docs/next/deploy/docker_install_advanced">master (unreleased)</a></li><li class="menu__list-item"><a class="menu__link" href="/netsage-pipeline/docs/pipeline">1.2.6</a></li><li class="menu__list-item"><a class="menu__link" href="/netsage-pipeline/docs/1.2.5/pipeline">1.2.5</a></li></ul></li><li class="menu__list-item"><a href="https://github.com/netsage-project/netsage-pipeline/" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_2gpo"><div class="docSidebarContainer_3_JD" role="complementary"><div class="sidebar_2urC"><div class="menu menu--responsive menu_5FrY"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_Dm3K" xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 32 32" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Pipeline</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/netsage-pipeline/docs/next/pipeline/intro">Intro</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/netsage-pipeline/docs/next/pipeline/tstat">Tstat</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/netsage-pipeline/docs/next/pipeline/nfdump">Nfdump</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/netsage-pipeline/docs/next/pipeline/importer">Importer</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/netsage-pipeline/docs/next/pipeline/logstash">Logstash</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/netsage-pipeline/docs/next/pipeline/elastic">Elastic Search</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Deployment</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/netsage-pipeline/docs/next/deploy/choose_install">Choose Install</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/netsage-pipeline/docs/next/deploy/bare_metal_install">Server Installation Guide</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/netsage-pipeline/docs/next/deploy/docker_install_simple">Docker Simple</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/netsage-pipeline/docs/next/deploy/docker_install_advanced">Docker Advanced</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/netsage-pipeline/docs/next/deploy/docker_troubleshoot">Troubleshooting</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Deployment Guides</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/netsage-pipeline/docs/next/devel/dev_dataset">Replay Dataset</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/netsage-pipeline/docs/next/devel/docker_dev_guide">Docker Dev Guide</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Documentation</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/netsage-pipeline/docs/next/docusaurus">Documentation Guide</a></li></ul></li></ul></div></div></div><main class="docMainContainer_3EyW"><div class="container padding-vert--lg docItemWrapper_1EkI"><div class="row"><div class="col docItemCol_2ASc"><div class="alert alert--warning margin-bottom--md" role="alert"><div>This is unreleased documentation for Netsage Pipeline Documentation <strong>master (unreleased)</strong> version.</div><div class="margin-top--md">For up-to-date documentation, see the <strong><a href="/netsage-pipeline/docs/pipeline">latest version</a></strong> (1.2.6).</div></div><div class="docItemContainer_3QWW"><article><div><span class="badge badge--secondary">Version: master (unreleased)</span></div><header><h1 class="docTitle_1Lrw">Docker Advanced Installation Guide</h1></header><div class="markdown"><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="dockerized-nfdump"></a>Dockerized Nfdump<a aria-hidden="true" tabindex="-1" class="hash-link" href="#dockerized-nfdump" title="Direct link to heading">#</a></h2><p>If you wish to use dockerized version of the collectors, then there are three components to be aware of.</p><ul><li>collector docker container needs to run listening for sflow, or netflow traffic.</li><li>an ENV value needs to be set that tags the sensor name.</li><li>a unique data output path should be set.</li><li>importer needs to be updated to be aware of the filepath and the sensor name.</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="step-1-create-a-config"></a>Step 1 Create a config<a aria-hidden="true" tabindex="-1" class="hash-link" href="#step-1-create-a-config" title="Direct link to heading">#</a></h3><p>If you need to create more collectors the pattern is always the same. Simply add</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-yaml codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">uber-collector</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">image</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> netsage/nfdump</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">collector</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">1.6.18</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">restart</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> always</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">command</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> sfcapd </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">T all </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">l /data </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">S 1 </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">w </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">z </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">p 9998</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">volumes</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> ./data/input_data/sflow</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">/data</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">ports</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> &quot;9998</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">9998/udp</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div></div></div></div></div><ul><li>collector-name: should be updated to something that has some meaning.</li><li>command: there are several binaries available in the collector, including: <code>nfanon, nfcapd,nfdump, nfexpire, nfreplay, sfcapd</code> . You&#x27;ll need to choose between sfcapd and nfcapd which are two processes that collect data. Define a port that will be used to capture data.</li><li>ports: make sure this matches the port you&#x27;ve defined. Naturally all ports have to be unique for that host.</li><li>Configure routers to point to the UDP port we&#x27;ve exposed on the given host.</li><li>define a sensor name to use. The value doesn&#x27;t matter but it has to be unique and we&#x27;ll make the importer aware of it.</li><li>volumes: make sure the path where the data is going in unique. In this case, we&#x27;re persisting data to ./data/input_data/sflow. The last part of the path is usually changed to some unique identifier.</li></ul><p>We&#x27;re going to build an example custom configuration. The only changes we&#x27;ll be making right now is
to update the volums to this line.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-yaml codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> ./data/input_data/uber_collector</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">/data</span></div></div></div></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="step-2-create-an-unique-environment-variable"></a>Step 2 Create an unique environment variable<a aria-hidden="true" tabindex="-1" class="hash-link" href="#step-2-create-an-unique-environment-variable" title="Direct link to heading">#</a></h3><p>For this example I&#x27;m going to create a new env value in my .env file. I&#x27;m going to name my sensor uberSensor and then later make the importer aware of it.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-sh codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">uberSensor=magicValue</span></div></div></div></div></div><p>Also, if you are diverging from the default you will also need to create a custom importer configuration which will be stored at: /userConfig/netsage_override.xml. More will be explained under the importer custom section. Please uncomment the line in line under the importer in the override file.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="step-3-running-the-collectors"></a>Step 3 Running the collectors<a aria-hidden="true" tabindex="-1" class="hash-link" href="#step-3-running-the-collectors" title="Direct link to heading">#</a></h3><p>After selecting the docker version to run, you can start the collectors by running the following line:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-sh codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">docker-compose up -d uber-collector</span></div></div></div></div></div><p>Naturally the names of the services will need to be updated. Also if you haven&#x27;t already done so you may remove any collectors you&#x27;re not using from the override file (docker-compose.override.yml).</p><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>The default version of the collector is 1.6.18. There are other versions released and :latest should be point to the latest one, but there is no particular effort made to make sure we released the latest version. You can get a listing of all the current tags listed <a href="https://hub.docker.com/r/netsage/nfdump-collector/tags" target="_blank" rel="noopener noreferrer">here</a> and the source to generate the docker image can be found <a href="https://github.com/netsage-project/docker-nfdump-collector" target="_blank" rel="noopener noreferrer">here</a> the code for the You may use a different version though there is no particular effort to have an image for every nfdump release.</p></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="running-the-pipeline"></a>Running the Pipeline<a aria-hidden="true" tabindex="-1" class="hash-link" href="#running-the-pipeline" title="Direct link to heading">#</a></h2><p>Once you&#x27;ve created the docker-compose.override.xml and finished adjusting it for any customizations, then you&#x27;re ready to select your version.</p><p>Before continuing you need to choose if you are going to be use the &#x27;Develop&#x27; version which has the latest changes but might be a bit less stable or using the &#x27;Release&#x27; version. If you&#x27;re opting to use the Develop version, then simply skip the version selection step.</p><div class="admonition admonition-caution alert alert--warning"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>caution</h5></div><div class="admonition-content"><p>Warning! it is HIGHLY recommended to not use the :latest as that is intended to be a developer release. You may still use it but be aware that you may have some instability each time you update.</p></div></div><ul><li>Select Release version<ul><li><code>git fetch; git checkout &lt;tag name&gt;</code> replace &quot;tag name&quot; with v1.2.5 or the version you intend to use.</li><li>Please select the version you wish to use using <code>./scripts/docker_select_version.sh</code></li></ul></li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="environment-file"></a>Environment file<a aria-hidden="true" tabindex="-1" class="hash-link" href="#environment-file" title="Direct link to heading">#</a></h3><p></p><p>Please make a copy of the .env and refer back to the docker <a href="/netsage-pipeline/docs/next/devel/docker_dev_guide">dev guide</a> on details on configuring the env. Most of the default value should work just fine.</p><p>The only major change you should be aware of are the following values. The output host defines where the final data will land. The sensorName defines what the data will be labeled as.</p><p>If you don&#x27;t send a sensor name it&#x27;ll use the default docker hostname which changes each time you run the pipeline.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-ini codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">rabbitmq_output_host=rabbit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">rabbitmq_output_username=guest</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">rabbitmq_output_pw=guest</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">rabbitmq_output_key=netsage_archive_input</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">sflowSensorName=sflowSensorName</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">netflowSensorName=netflowSensorName</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">## Optional configurations</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">## Not required, but these are exposed if you wish to use a different</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">## value </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">aggregation_maps_path=/data/logstash-aggregation-maps ## this is configurable, but /data is required.  </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">inactivity_timeout=630 ##  See below</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">max_flow_timeout=86400 ## cut off flows that are longer the N seconds.  Default is 24 hours</span></div></div></div></div></div><p>Please note, the default is to have one netflow collector and one sflow collector. If you need more collectors or do no need netflow or sflow simply comment out the collector you wish to ignore.  If you are following the advanced guide, you&#x27;ll naturally have a more complex setup for each additional collector you&#x27;ve configured.</p><h3>inactivity_timeout</h3><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>If more than inactivity_timeout seconds have passed between the &#x27;start&#x27; of this event and the &#x27;start&#x27;
of the LAST matching event, OR if no matching flow has coming in for inactivity_timeout seconds
on the clock, assume the flow has ended.
Use 630 sec = 10.5 min for 5-min files,  960 sec = 16 min for AMPATH which has has 15-min files.
(For 5-min files, this allows one 5 min gap or period during which the no. of bits transferred don&#x27;t meet the cutoff)</p></div></div><p></p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="custom-importer-config"></a>Custom Importer Config<a aria-hidden="true" tabindex="-1" class="hash-link" href="#custom-importer-config" title="Direct link to heading">#</a></h3><p>The pipeline allows to have as many collectors as desired. You should have a unique sensorName ENV variable for each type and a unique path where data is being delivered.</p><p>By convention everything is being written to ./data/input_data/sensorName You may change that behavior but just ensure the path between the colle</p><ol><li>Copy the compose/importer/netsage_shared.xml to userConfig/ and name it netsage_override.xml</li><li>In the docker-compose.yml uncomment the following line from the importer configuration.</li></ol><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-sh codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      - ./userConfig/netsage_override.xml:/etc/grnoc/netsage/deidentifier/netsage_shared.xml</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div></div></div></div></div><p>This will use the <code>netsage_override.xml</code> in the userConfig instead of the container settings.</p><ol start="3"><li>Update collectors.</li></ol><p>You may add as many new collectors as you like just ensure the following is unique:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-yml codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token key atrule">example-collector</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">image</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> netsage/nfdump</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">collector</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">1.6.18</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">command</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> nfcapd </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">T all </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">l /data </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">S 1 </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">w </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">z </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">p 9999</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">ports</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;9999:9999/udp&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">restart</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> always</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">volumes</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> ./data/input_data/example</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">/data</span></div></div></div></div></div><ul><li>The command call should be updated. nfcapd for netflow, sfcapd for sflow</li><li>The output under volumes needs to be unique. Replace /example with the appropriate value</li><li>Make sure to update the port. The UDP port has to be unique. Please update the command and port mapping.</li></ul><p>Technically you don&#x27;t need to change to port of the command, but make sure you use the correct pattern when mapping the new settings.</p><p>Example:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-yml codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token key atrule">ports</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;9999:4321/udp&quot;</span></div></div></div></div></div><p>The first port is the port on your host, the second port is the port on your local machine.</p><ol start="4"><li>Update the netsage_override.xml and add a new entry for the collector you&#x27;re adding under the config section.</li></ol><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-xml codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">collection</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">flow-path</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain">/data/input_data/example</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">flow-path</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">sensor</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain">$exampleSensorName</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">sensor</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">flow-type</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain">sflow</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">flow-type</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">collection</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div></div></div></div></div><ol start="5"><li>Update the environment file.</li></ol><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-ini codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">exampleSensorName=example</span></div></div></div></div></div><ol start="6"><li>At this point, please update the router configuration to send data to the new port you&#x27;ve defined. If the new collector is listening on 0.0.0.0:1234/udp then all traffic you wish grouped under</li></ol><p>the new sensor should be send to 1234/udp.</p><p>You will need to repeat steps 3-6 for each collector you&#x27;re adding. For each new configuration the path, sensorName and exposed port have to be unique. Besides that, there is no limit
outside of the bounds of the host&#x27;s resources to how many collectors you may run.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="customize-logstash-settings"></a>Customize Logstash Settings<a aria-hidden="true" tabindex="-1" class="hash-link" href="#customize-logstash-settings" title="Direct link to heading">#</a></h3><p>Rename the provided example for JVM Options and tweak the settings as desired.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-sh codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">cp userConfig/jvm.options_example userConfig/jvm.options</span></div></div></div></div></div><p>Update the docker-compose.override.xml and ensure the logstash section is updated. It should look something along these lines.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-yaml codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token key atrule">logstash</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">image</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> netsage/pipeline_logstash</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">latest</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">volumes</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> ./userConfig/jvm.options</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">/usr/share/logstash/config/jvm.options</span></div></div></div></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="kibana-and-elastic-search"></a>Kibana and Elastic Search<a aria-hidden="true" tabindex="-1" class="hash-link" href="#kibana-and-elastic-search" title="Direct link to heading">#</a></h3><p>The file docker-compose.develop.yaml can be found in conjunction with docker-compose.yaml to bring up the optional Kibana and Elastic Search components.</p><p>This isn&#x27;t a production pattern but the tools can be useful at times. Please refer to the <a href="/netsage-pipeline/docs/next/devel/docker_dev_guide#optional-elasticsearch-and-kibana">Docker Dev Guide</a></p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="bringing-up-the-pipeline"></a>Bringing up the Pipeline<a aria-hidden="true" tabindex="-1" class="hash-link" href="#bringing-up-the-pipeline" title="Direct link to heading">#</a></h3><p></p><p>Starting up the pipeline using:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-sh codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">docker-compose up -d</span></div></div></div></div></div><p>You can check the logs for each of the container by running</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-sh codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">docker-compose logs</span></div></div></div></div></div><h3>Shutting Down the pipeline.</h3><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-sh codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">docker-compose down</span></div></div></div></div></div><p></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="upgrading"></a>Upgrading<a aria-hidden="true" tabindex="-1" class="hash-link" href="#upgrading" title="Direct link to heading">#</a></h2><p></p><h3>Update Source Code</h3><p>If your only changes are the version you selected simply reset and discard your changes.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-sh codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">git reset --hard</span></div></div></div></div></div><p>Update the git repo. Likely this won&#x27;t change anything but it&#x27;s always a good practice to have the latest version. You will need to do at least a git fetch in order to see the latest tags.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-sh codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">git pull origin master</span></div></div></div></div></div><h3>Collectors</h3><p>Since the collectors live outside of version control. Please check the docker-compose.override_example.yml and see if there any changes you need to bring in.</p><p>Likely the only change of note might be the docker version.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-yaml codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token key atrule">version</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;3.7&quot;</span></div></div></div></div></div><h3>Select Release Version</h3><ol><li>git checkout &lt;tag_value&gt; (ie. v1.2.6, v1.2.7 etc)</li><li><code>./scripts/docker_select_version.sh</code> select the same version as the tag you checked out.</li></ol><h3>Update docker containers</h3><p>This applies for both development and release</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">docker-compose pull</span></div></div></div></div></div><p></p></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/netsage-project/netsage-pipeline/edit/master/website/docs/deploy/docker_install_advanced.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 40 40" style="margin-right:0.3em;vertical-align:sub"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/netsage-pipeline/docs/next/deploy/docker_install_simple"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Docker Default Installation Guide</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/netsage-pipeline/docs/next/deploy/docker_troubleshoot"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Docker Troubleshooting Â»</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_3SO_"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#dockerized-nfdump" class="table-of-contents__link">Dockerized Nfdump</a><ul><li><a href="#step-1-create-a-config" class="table-of-contents__link">Step 1 Create a config</a></li><li><a href="#step-2-create-an-unique-environment-variable" class="table-of-contents__link">Step 2 Create an unique environment variable</a></li><li><a href="#step-3-running-the-collectors" class="table-of-contents__link">Step 3 Running the collectors</a></li></ul></li><li><a href="#running-the-pipeline" class="table-of-contents__link">Running the Pipeline</a><ul><li><a href="#environment-file" class="table-of-contents__link">Environment file</a></li><li><a href="#custom-importer-config" class="table-of-contents__link">Custom Importer Config</a></li><li><a href="#customize-logstash-settings" class="table-of-contents__link">Customize Logstash Settings</a></li><li><a href="#kibana-and-elastic-search" class="table-of-contents__link">Kibana and Elastic Search</a></li><li><a href="#bringing-up-the-pipeline" class="table-of-contents__link">Bringing up the Pipeline</a></li></ul></li><li><a href="#upgrading" class="table-of-contents__link">Upgrading</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="text--center"><div>Copyright Â© 2020 NetSage Built with Docusaurus.</div></div></div></footer></div>
<script src="/netsage-pipeline/styles.30a89ff9.js"></script>
<script src="/netsage-pipeline/runtime~main.5ea87a7f.js"></script>
<script src="/netsage-pipeline/main.f582d45e.js"></script>
<script src="/netsage-pipeline/1.e1463b01.js"></script>
<script src="/netsage-pipeline/2.444a8fa2.js"></script>
<script src="/netsage-pipeline/43.5653398d.js"></script>
<script src="/netsage-pipeline/44.4b500b20.js"></script>
<script src="/netsage-pipeline/935f2afb.4f4751f2.js"></script>
<script src="/netsage-pipeline/17896441.3d630ac9.js"></script>
<script src="/netsage-pipeline/cbd1c0d0.e0c9944f.js"></script>
</body>
</html>